{% macro num_or_none(value) %}
(
    CASE
        ---------------------------------------------------------------------
        -- Python: if s is None → return None
        ---------------------------------------------------------------------
        WHEN {{ value }} IS NULL THEN NULL

        ---------------------------------------------------------------------
        -- Python: s = str(s).strip()
        -- Python: if NUM_DEC.match(s) → return float(s)
        -- NUM_DEC: ^[+-]?\d+(\.\d+)?$
        ---------------------------------------------------------------------
        WHEN REGEXP_LIKE(
                TRIM({{ value }}::string),
                '^[+-]?[0-9]+(\\.[0-9]+)?$'
             )
        THEN TRY_TO_DOUBLE(TRIM({{ value }}::string))

        ---------------------------------------------------------------------
        -- Python: return None (no match)
        ---------------------------------------------------------------------
        ELSE NULL
    END
)
{% endmacro %}
